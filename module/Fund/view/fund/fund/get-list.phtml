<?php

// set default order if not set and inverse the order based on the previous value
$order = isset($query['order']) ? $query['order'] : 'ASC';
$order = ($order == 'ASC') ? 'DESC' : 'ASC';

$form->setAttribute('method', 'GET');
$form->setAttribute('action', $this->url('funds', array(), array('query' => $query)));
?>

<div class="row">
  <div class="col-md-8">
  <table class="table table-bordered table-hover">
	<thead>
		<tr>
			<th>
        <a href="<?php echo $this->escapeHtmlAttr($this->url('funds', array(), array('query' => array('sort' => 'name', 'order' => $order) + $query))); ?>">
           <?php echo $this->translate('Name') ?>
        </a>
      </th>
        <th>
				  <a href="<?php echo $this->escapeHtmlAttr($this->url('funds', array(), array('query' => array('sort' => 'sustainability', 'order' => $order)  + $query))); ?>">
            <?php echo $this->translate('Sustainable investments') ?>
          </a>
        </th>
		</tr>
	</thead>
	<tbody>
	<?php foreach ($funds as $fund): ?>
		<tr>
			<td>
        <a href="<?php echo $this->escapeHtmlAttr($this->url('funds', array('id' => $fund->id))) ?>" title="">
          <?php echo $this->translate($fund->name) ?>
        </a>
      </td>
      <td>
        <?php
          echo $this->numberFormat(
            $fund->getSustainability(),
            NumberFormatter::PERCENT,
            NumberFormatter::TYPE_DEFAULT,
            "en_US"
          );
        ?>
      </td>
		</tr>
	<?php endforeach; ?>
	</tbody>
  </table>

  <?php if ($funds->getPages()->pageCount): ?>

    <div>
        <ul class="pagination pagination-centered">
            <!-- Previous page link -->
            <?php if (isset($funds->getPages()->previous)): ?>
                <li>
                    <a href="<?php echo $this->escapeHtmlAttr($this->url('funds', array(), array('query' => array('page' => $funds->getPages()->previous) + $query))); ?>">
                      &laquo;
                    </a>
                </li>
            <?php
            else: ?>
                <li class="disabled">
                    <a href="#">
                      &laquo;
                    </a>
                </li>
            <?php endif; ?>
            <!-- Numbered page links -->
            <?php foreach ($funds->getPages()->pagesInRange as $page): ?>
                <?php if ($page != $funds->getPages()->current): ?>
                    <li>
                        <a href="<?php echo $this->escapeHtmlAttr($this->url('funds', array(), array('query' => array('page' => $page)  + $query))); ?>">
                            <?php echo $page; ?>
                        </a>
                    </li>
                <?php else: ?>
                    <li class="active">
                        <a href="#"><?php echo $page; ?></a>
                    </li>
                <?php endif; ?>
            <?php endforeach; ?>

            <!-- Next page link -->
            <?php if (isset($funds->getPages()->next)): ?>
                <li>
                    <a href="<?php echo $this->escapeHtmlAttr($this->url('funds', array(), array('query' => array('page' => $funds->getPages()->next) + $query))); ?>">
                        &raquo;
                    </a>
                </li>
            <?php else: ?>
                <li class="disabled">
                    <a href="#">
                        &raquo;
                    </a>
                </li>
            <?php endif; ?>
        </ul>
    </div>
  <?php endif; ?>
  </div>
  <div class="col-md-4 well">
    <h2><?php echo $this->translate('Category') ?></h2>
    <?php echo $this->form($form); ?>
  </div>
</div>
