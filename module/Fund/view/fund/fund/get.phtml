<?php

$this->headScript()
->prependFile($this->basePath() . '/vendor/selectize/dist/js/standalone/selectize.min.js')
//->prependFile($this->basePath() . '/vendor/chartjs/Chart.min.js')
->appendFile($this->basePath() . '/js/fundprofile.js');
//->appendFile($this->basePath() . '/js/sustainability-chart.js');
?>

<section class="container fund-page">
  <h1><?php echo $this->escapeHtml($fund->name) ?></h1>
  <div class="row">
    <div class="col-md-8">
      <?php echo $this->partial('sustainability-categories',
      array(
      'sform' => $this->sform,
      'sustainability' => $sustainability
      )
      ); ?>

      <div class="panel panel-default">
        <div class="panel-heading">
          <h3>
            <?php echo $this->translate('Hållbara investeringar') ?>
          </h3>
        </div>
        <div class="panel-body">
          <div class="row">
            <div class="chart-container pull-left big-chart">
              <img src="/img/sustainability-score-symbol.png" alt="Hållbarhetsnivå-symbol" />
            </div>
            <div class="sustainability-number">
              <?php echo $fund->getSustainabilityScore()*10; ?>/10
            </div>
          </div>

          <?php if ($cCategoriesCount): ?>
            <p>
              <?php echo $this->translate('Hållbarheten i fonden är uträknad utifrån dina valda hållbarhetskategorier. Fonden når inte full hållbarhetsnivå då den investerar i företag kopplade till:') ?>
            </p>

            <ul class="sustainability-categories-list">
              <?php foreach ($cCategoriesCount as $cCat): ?>
                <li><?php echo $this->translate($cCat[0]); ?></li>
              <?php endforeach; ?>
            </ul>
          <?php else: ?>
            <p>
              <?php echo $this->translate('Fonden har inga bolag i de kategorier du valt och har därför full hållbarhetsnivå!') ?>
            </p>
            <?php endif; ?>

            <table class="table sustainability-grades-explained">
              <thead>
              <th></th>
              <th><h4><?php echo $this->translate('Hållbarhetsnivåer') ?></h4></th>
              </thead>
              <tbody>
              <tr>
                <td class="chart-cell">
                  <div class="chart-container pull-left small-chart">
                      <img src="/img/sustainability-score-symbol.png" alt="Hållbarhetsnivå-symbol" />
                  </div>
                </td>
                <td>
                  <strong>10:</strong> <?php echo $this->translate('Hållbar fond enligt din sökning.') ?>
                </td>
              </tr>
              <tr>
                <td>
                  <div class="chart-container pull-left small-chart">
                    <img src="/img/sustainability-score-symbol.png" alt="Hållbarhetsnivå-symbol" />
                  </div>
                </td>
                <td>
                  <strong>8-9:</strong> <?php echo $this->translate('Fonden har ett fåtal ohållbara bolag.') ?>
                </td>
              </tr>
              <tr>
                <td>
                  <div class="chart-container pull-left small-chart">
                    <img src="/img/sustainability-score-symbol.png" alt="Hållbarhetsnivå-symbol" />
                  </div>
                </td>
                <td>
                  <strong>6-7:</strong> <?php echo $this->translate('Fonden har en stor del ohållbara bolag.') ?>
                </td>
              </tr>
              <tr>
                <td>
                  <div class="chart-container pull-left small-chart">
                    <img src="/img/sustainability-score-symbol.png" alt="Hållbarhetsnivå-symbol" />
                  </div>
                </td>
                <td>
                  <strong>4-5:</strong> <?php echo $this->translate('Fonden har en mycket stor del ohållbara bolag.') ?>
                </td>
              </tr>
              <tr>
                <td>
                  <div class="chart-container pull-left small-chart">
                    <img src="/img/sustainability-score-symbol.png" alt="Hållbarhetsnivå-symbol" />
                  </div>
                </td>
                <td>
                  <strong>1-3:</strong> <?php echo $this->translate('Denna fond stämmer inte in på dina hållbarhetskriterier.') ?>
                </td>
              </tr>
            </tbody>

            </table>
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading">
            <h3>CO<sub>2-</sub><?php echo $this->translate('utsläpp') ?></h3>
          </div>
          <div class="panel-body">
            <div class="row">
              <img class="co2-meter-symbol" src="/img/co2-symbol.png" alt="CO2-symbol" />
                <div class="co2-meter">
                  <div class="co2-meter-number">
                    <?php if ($fund->co2Coverage > $fund->co2CoverageLimit):?>
                      <?php
                      if ($fund->co2 < 10):
                      echo number_format($fund->co2, 2, ',', ' ');
                      else:
                      echo number_format($fund->co2, 1, ',', ' ');
                      endif;
                      ?>
                    <?php else: ?>
                      <?php echo $this->translate('N/A') ?>
                    <?php endif; ?>
                  </div>
                  <div class="co2-meter-unit">gram CO<sub>2</sub>/kr</div>
                </div>
              </div>
              <div class="co2-text">
                <p><?php echo $this->translate('Företagen i fondens gemensamma');?> CO<sub>2</sub>- <?php echo $this->translate('utsläpp') ?>.</p>

                <?php echo $this->translate('Täckningsgrad: ') ?>
                <strong>
                <?php
                echo $this->numberFormat(
                $fund->co2Coverage,
                NumberFormatter::PERCENT,
                NumberFormatter::TYPE_DEFAULT,
                "en_US"
                );
                ?>
                </strong>

                <?php echo $this->translate(' - andel av fonden som vi har CO<sub>2</sub>-utsläppsdata på.') ?>
                <?php if ($fund->co2Coverage > $fund->co2CoverageLimit):?>
                <?php else: ?>
                  <br>
                  <?php echo $this->translate('CO<sub>2</sub> per krona räknas bara ut om täckningsgraden är över 50 procent för att ge ett rättvist värde.') ?>
                <?php endif; ?>

                <br><br>
                <p>
                  <?php echo $this->fund->name . $this->translate(' tillhör kategorin ') . $this->fund->fondoutCategory->title . ".<br>"; ?>
                  <?php echo $this->translate('Kategorins snitt är: ') . number_format($this->categoryCo2, 1, ',', ' ') . ' gram CO<sub>2</sub>/kr. <br>'; ?>
                  <?php echo $this->translate('Täckningsgraden i kategorin är ') .
                    $this->numberFormat(
                    $this->categoryCo2Coverage,
                    NumberFormatter::PERCENT,
                    NumberFormatter::TYPE_DEFAULT,
                    "en_US"
                    ) . "."; ?>
                </p>
              </div>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="panel panel-default">
          <div class="panel-heading"><h3><?php echo $this->translate('Köp fonden') ?></h3></div>
          <div class="panel-body">
            <p>
              <?php echo $this->translate('Fonden finns tillgänglig att köpa på:') ?>
            </p>
            <ul>
              <?php foreach ($banks as $bank): ?>
                <li><?php echo $this->translate($bank['name']) ?></li>
              <?php endforeach; ?>
            </ul>
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3><?php echo $this->translate('Liknande fonder') ?></h3></div>
          <div class="panel-body">

            <table class="table table-hover">
              <!--
              <thead>
                <tr>
                  <th>
                    <?php echo $this->translate('Fond') ?>
                  </th>
                  <th>
                    <?php echo $this->translate('Hållbarhet') ?>
                  </th>
                </tr>
              </thead>

              -->
              <tbody>
                <?php foreach ($funds as $fund): ?>
                  <tr>
                    <td>
                      <h4>
                      <a href="<?php echo $this->escapeHtmlAttr($this->url('funds', array('id' => $fund->id))) ?>" title="">
                        <?php echo $this->translate($fund->name) ?>
                      </a>
                      </h4>
                      <div class="similar-funds-sustainability pull-right">
                        <div class="chart-container similar-chart">
                          <img src="/img/sustainability-score-symbol.png" alt="Hållbarhetsnivå-symbol" />
                        </div>
                        <span class="similar-sustianability-score"><?php echo $fund->getSustainabilityScore()*10; ?>/10 </span>
                      </div>

                      <div class="similar-funds-co2  pull-left">
                        <img class="similar-funds-co2-symbol" src="/img/co2-symbol.png" alt="CO2-symbol" />
                        <span class="similar-co2-number">
                          <?php
                          if ($fund->getCo2Coverage() > $fund->co2CoverageLimit) :
                          echo number_format($fund->getCo2(), 2) . "g/kr";
                          else:
                          /*echo $this->translate('CO<sub>2</sub>-utsläpp ej tillgängligt.');*/
                          echo $this->translate('N/A');
                          endif;
                          ?>
                        </span>
                      </div>

                    </td>
                  </tr>
                <?php endforeach; ?>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </section>
